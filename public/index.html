<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BookHub - Th∆∞ Vi·ªán S√°ch ƒêi·ªán T·ª≠</title>
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <meta name="google-signin-client_id" content="331612732204-1t1ea8eqoln2uhnc8hnuctelim6docsj.apps.googleusercontent.com">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 1rem;
        }

        .container {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            width: 100%;
            max-width: 450px;
            transform: translateY(20px);
            animation: slideUp 0.8s ease-out forwards;
        }

        @keyframes slideUp {
            to { transform: translateY(0); }
        }

        .header {
            background: linear-gradient(135deg, #ff6b6b, #ee5a52);
            color: white;
            text-align: center;
            padding: 2rem;
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
            animation: float 6s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px) rotate(0deg); }
            50% { transform: translateY(-20px) rotate(180deg); }
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
            position: relative;
            z-index: 1;
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
            position: relative;
            z-index: 1;
        }

        .login-section {
            padding: 2rem;
        }

        .login-container {
            display: flex;
            flex-direction: column;
            gap: 2rem;
            text-align: center;
            max-width: 400px;
            margin: 0 auto;
        }

        .login-header h2 {
            color: #333;
            margin-bottom: 1rem;
            font-size: 1.8rem;
        }

        .login-instruction {
            color: #4a90e2;
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 1.5rem;
            line-height: 1.4;
        }

        .security-note {
            background: linear-gradient(135deg, #e8f4fd, #f0f8ff);
            border: 1px solid #b3d9ff;
            border-radius: 12px;
            padding: 1.5rem;
            margin: 1rem 0;
        }

        .security-note p:first-child {
            color: #2c5282;
            font-weight: 700;
            margin-bottom: 0.5rem;
            font-size: 1rem;
        }

        .security-note p:last-child {
            color: #4a5568;
            font-size: 0.9rem;
            line-height: 1.4;
        }

        #googleSignInContainer {
            width: 100%;
            display: flex;
            justify-content: center;
            margin: 1.5rem 0;
        }

        #g_id_signin {
            width: 100%;
            max-width: 280px;
        }

        .login-footer {
            text-align: center;
            margin-top: 1rem;
        }

        .login-footer small {
            color: #718096;
            font-size: 0.85rem;
            line-height: 1.4;
        }

        .success-message {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 1rem;
            text-align: center;
        }

        .error-message {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 1rem;
            text-align: center;
        }

        /* Mobile responsive */
        @media (max-width: 768px) {
            .header h1 {
                font-size: 2rem;
            }
            
            .container {
                margin: 0.5rem;
            }
            
            .login-section {
                padding: 1.5rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üìö BookHub</h1>
            <p>Th∆∞ vi·ªán s√°ch ƒëi·ªán t·ª≠ cao c·∫•p</p>
        </div>

        <div class="login-section">
            <div id="messageContainer"></div>
            
            <div class="login-container">
                <div class="login-header">
                    <h2>üîê Truy C·∫≠p Th∆∞ Vi·ªán</h2>
                </div>
                
                <div class="login-instruction">
                    H√£y ƒëƒÉng nh·∫≠p b·∫±ng Gmail ƒë·ªÉ ti·∫øp t·ª•c
                </div>
                
                <div class="security-note">
                    <p>üîí B·∫£o m·∫≠t cao</p>
                    <p>Ch·ªâ nh·ªØng t√†i kho·∫£n ƒë∆∞·ª£c ·ªßy quy·ªÅn m·ªõi c√≥ th·ªÉ truy c·∫≠p n·ªôi dung</p>
                </div>

                <div id="googleSignInContainer">
                    <div id="g_id_onload"
                         data-client_id="331612732204-1t1ea8eqoln2uhnc8hnuctelim6docsj.apps.googleusercontent.com"
                         data-context="signin"
                         data-ux_mode="popup"
                         data-callback="handleGoogleSignIn"
                         data-auto_prompt="false">
                    </div>
                    
                    <div id="g_id_signin"></div>
                </div>

                <div class="login-footer">
                    <small>üí° S·ª≠ d·ª•ng t√†i kho·∫£n Google c·ªßa b·∫°n ƒë·ªÉ ƒëƒÉng nh·∫≠p an to√†n.</small>
                    <br><br>
                    <small style="color: #999;">üîß Phi√™n b·∫£n Frontend Only - Kh√¥ng c·∫ßn backend API</small>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Configuration (Frontend only)
        const CONFIG = {
            GOOGLE_CLIENT_ID: '331612732204-1t1ea8eqoln2uhnc8hnuctelim6docsj.apps.googleusercontent.com'
        };

        // DOM Elements
        const messageContainer = document.getElementById('messageContainer');

        // Google Sign-In initialization with fallback
        function initializeGoogleSignIn() {
            console.log('üîß Initializing Google Sign-In...');
            
            // Show loading state
            const buttonContainer = document.getElementById('g_id_signin');
            if (buttonContainer) {
                buttonContainer.innerHTML = '<div style="text-align: center; padding: 12px; color: #666;">ƒêang t·∫£i Google Sign-In...</div>';
            }
            
            if (typeof google !== 'undefined' && google.accounts) {
                console.log('‚úÖ Google SDK loaded successfully');
                
                try {
                    google.accounts.id.initialize({
                        client_id: CONFIG.GOOGLE_CLIENT_ID,
                        callback: handleGoogleSignIn,
                        auto_select: false,
                        cancel_on_tap_outside: true
                    });
                    
                    if (buttonContainer) {
                        google.accounts.id.renderButton(buttonContainer, {
                            theme: 'outline',
                            size: 'large',
                            text: 'signin_with',
                            shape: 'rectangular',
                            logo_alignment: 'left',
                            width: 280
                        });
                        
                        console.log('‚úÖ Google Sign-In button rendered');
                        
                        // Check if button actually rendered
                        setTimeout(() => {
                            const gsiButton = buttonContainer.querySelector('div[role="button"]');
                            if (!gsiButton) {
                                console.warn('‚ö†Ô∏è Button not rendered, showing fallback');
                                showFallbackButton();
                            }
                        }, 2000);
                    }
                    
                } catch (error) {
                    console.error('‚ùå Google Sign-In initialization failed:', error);
                    showFallbackButton();
                }
                
            } else {
                console.warn('‚ö†Ô∏è Google SDK not loaded');
                showFallbackButton();
            }
        }
        
        // Fallback button when Google SDK fails
        function showFallbackButton() {
            const buttonContainer = document.getElementById('g_id_signin');
            if (buttonContainer) {
                buttonContainer.innerHTML = `
                    <div style="
                        display: inline-flex;
                        align-items: center;
                        justify-content: center;
                        width: 100%;
                        max-width: 280px;
                        height: 50px;
                        background: white;
                        border: 1px solid #dadce0;
                        border-radius: 4px;
                        color: #3c4043;
                        cursor: pointer;
                        font-family: 'Segoe UI', Arial, sans-serif;
                        font-size: 14px;
                        font-weight: 500;
                        text-decoration: none;
                        transition: all 0.2s ease;
                        box-shadow: 0 1px 3px rgba(0,0,0,0.1);
                    " 
                    onmouseover="this.style.boxShadow='0 2px 8px rgba(0,0,0,0.15)'"
                    onmouseout="this.style.boxShadow='0 1px 3px rgba(0,0,0,0.1)'"
                    onclick="handleFallbackSignIn()">
                        <svg width="18" height="18" style="margin-right: 12px;" viewBox="0 0 24 24">
                            <path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/>
                            <path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/>
                            <path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/>
                            <path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/>
                        </svg>
                        ƒêƒÉng nh·∫≠p b·∫±ng Google
                    </div>
                `;
                
                showMessage('‚ö†Ô∏è ƒêang s·ª≠ d·ª•ng phi√™n b·∫£n d·ª± ph√≤ng. N·∫øu c√≥ v·∫•n ƒë·ªÅ, h√£y th·ª≠ t·∫Øt AdBlock ho·∫∑c ƒë·ªïi tr√¨nh duy·ªát.', 'error');
            }
        }
        
        // Handle fallback button click
        function handleFallbackSignIn() {
            showMessage('üîÑ ƒêang kh·ªüi ƒë·ªông l·∫°i Google Sign-In...', 'success');
            
            // Try to reinitialize
            setTimeout(() => {
                window.location.reload();
            }, 1500);
        }

        // Handle Google Sign-In (Frontend only version)
        async function handleGoogleSignIn(response) {
            console.log('üîê Google Sign-In response received');
            
            try {
                // Decode the JWT token to get user info (frontend only)
                const userInfo = parseJWT(response.credential);
                console.log('‚úÖ User info extracted:', userInfo);
                
                if (userInfo && userInfo.email) {
                    // Simple email domain check (you can customize this)
                    const allowedDomains = ['gmail.com', 'googlemail.com']; // Add your allowed domains
                    const emailDomain = userInfo.email.split('@')[1];
                    
                    // For demo purposes, allow all Gmail accounts
                    // In production, you should have a proper backend verification
                    if (allowedDomains.includes(emailDomain) || userInfo.email_verified) {
                        showMessage(`üéâ Ch√†o m·ª´ng ${userInfo.name || userInfo.email}! ƒêƒÉng nh·∫≠p th√†nh c√¥ng.`, 'success');
                        
                        // Store user info locally (frontend only)
                        localStorage.setItem('bookhub_user', JSON.stringify({
                            name: userInfo.name,
                            email: userInfo.email,
                            picture: userInfo.picture,
                            loginMethod: 'google',
                            loginTime: new Date().toISOString()
                        }));
                        
                        // Redirect to your main application
                        setTimeout(() => {
                            showMessage('üîÑ ƒêang chuy·ªÉn h∆∞·ªõng...', 'success');
                            // You can redirect to your main app here
                            // window.location.href = '/dashboard.html';
                            console.log('‚úÖ Login successful, user data saved to localStorage');
                        }, 2000);
                        
                    } else {
                        showMessage('‚ùå T√†i kho·∫£n n√†y ch∆∞a ƒë∆∞·ª£c c·∫•p quy·ªÅn truy c·∫≠p.', 'error');
                    }
                } else {
                    showMessage('‚ùå Kh√¥ng th·ªÉ l·∫•y th√¥ng tin t·ª´ Google. Vui l√≤ng th·ª≠ l·∫°i.', 'error');
                }
                
            } catch (error) {
                console.error('‚ùå Google Sign-In processing error:', error);
                showMessage('‚ùå C√≥ l·ªói x·∫£y ra khi x·ª≠ l√Ω ƒëƒÉng nh·∫≠p. Vui l√≤ng th·ª≠ l·∫°i.', 'error');
            }
        }
        
        // Parse JWT token (simple frontend parsing)
        function parseJWT(token) {
            try {
                const base64Url = token.split('.')[1];
                const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
                const jsonPayload = decodeURIComponent(atob(base64).split('').map(function(c) {
                    return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);
                }).join(''));
                
                return JSON.parse(jsonPayload);
            } catch (error) {
                console.error('‚ùå JWT parsing error:', error);
                return null;
            }
        }

        // Show message
        function showMessage(message, type = 'info') {
            const messageDiv = document.createElement('div');
            messageDiv.className = type === 'error' ? 'error-message' : 'success-message';
            messageDiv.textContent = message;
            
            if (messageContainer) {
                messageContainer.innerHTML = '';
                messageContainer.appendChild(messageDiv);
                
                setTimeout(() => {
                    if (messageDiv.parentNode) {
                        messageDiv.remove();
                    }
                }, 5000);
            }
        }

        // Initialize app
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üöÄ BookHub Login initializing...');
            
            // Try multiple initialization attempts
            let attempts = 0;
            const maxAttempts = 3;
            
            function tryInitialize() {
                attempts++;
                console.log(`üîÑ Initialization attempt ${attempts}/${maxAttempts}`);
                
                if (typeof google !== 'undefined' && google.accounts) {
                    initializeGoogleSignIn();
                } else if (attempts < maxAttempts) {
                    console.log(`‚è≥ Waiting for Google SDK... (attempt ${attempts})`);
                    setTimeout(tryInitialize, 2000);
                } else {
                    console.warn('‚ùå Google SDK failed to load after multiple attempts');
                    showFallbackButton();
                }
            }
            
            // Start initialization
            setTimeout(tryInitialize, 1000);
            
            console.log('‚úÖ BookHub Login ready!');
        });

        console.log('üìö BookHub - Frontend Only Version');
        console.log('üîß Google Client ID configured');
        console.log('‚ö†Ô∏è No backend API required');
        console.log('‚úÖ Ready for authentication!');
    </script>
</body>
</html>
